<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantum Oracle | 3D Bloch HUD</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;600&display=swap');

:root {
    --neon-purple: #bc13fe;
    --neon-cyan: #00f3ff;
    --neon-lime: #bfff00;
    --glass: rgba(10, 25, 47, 0.8);
}

body {
    margin: 0; padding: 0;
    background: #020617;
    color: #e2e8f0;
    font-family: 'Rajdhani', sans-serif;
    overflow: auto;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
    padding-top: 20px;
}

#canvas-container { position: absolute; top:0; left:0; width:100%; height:100%; z-index:1; }

.hud-overlay {
    position: relative;
    z-index: 10;
    width: 90%;
    max-width: 1000px;
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 20px;
    pointer-events: none;
}

.panel {
    background: var(--glass);
    border: 1px solid rgba(0, 243, 255, 0.3);
    border-radius: 15px;
    padding: 20px;
    backdrop-filter: blur(15px);
    pointer-events: auto;
    box-shadow: 0 0 20px rgba(0, 243, 255, 0.1);
}

h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1rem;
    color: var(--neon-cyan);
    letter-spacing: 2px;
    margin: 0 0 15px 0;
    border-bottom: 1px solid var(--neon-purple);
    padding-bottom: 5px;
}

.control-group { margin-bottom: 15px; }
label { font-size: 0.7rem; color: var(--neon-purple); text-transform: uppercase; display: block; margin-bottom: 3px; }
select, input { font-size: 0.8rem; padding: 8px; }

.btn-execute {
    font-size: 0.8rem; padding: 10px;
    width: 100%;
    background: transparent;
    border: 2px solid var(--neon-lime);
    color: var(--neon-lime);
    font-family: 'Orbitron';
    cursor: pointer;
    transition: 0.3s;
    text-transform: uppercase;
    font-weight: bold;
}

.btn-execute:hover {
    background: var(--neon-lime);
    color: #000;
    box-shadow: 0 0 20px var(--neon-lime);
}

.data-display {
    display: flex; flex-direction: column; justify-content: flex-start;
    max-height: 80vh; overflow-y: auto;
}

.stat-card {
    background: rgba(0,0,0,0.4);
    border-left: 4px solid var(--neon-cyan);
    padding: 10px;
    margin-bottom: 8px;
}

.stat-card label { font-size: 0.65rem; }

#log { font-family: monospace; font-size: 0.7rem; height: 100px; overflow-y: auto; }

img { max-width: 90%; height: auto; border-radius: 10px; margin-top: 10px; display: none; }

</style>
</head>
<body>

<div id="canvas-container"></div>

<div class="hud-overlay">
    <div class="panel">
        <h1>QUANTUM CORE</h1>
        <form id="simForm">
            <div class="control-group">
                <label>Entanglement State</label>
                <select id="state" name="state">
                    <option value="phi_plus">Φ⁺ (Phi Plus)</option>
                    <option value="phi_minus">Φ⁻ (Phi Minus)</option>
                    <option value="psi_plus">Ψ⁺ (Psi Plus)</option>
                    <option value="psi_minus">Ψ⁻ (Psi Minus)</option>
                </select>
            </div>
            <div class="control-group">
                <label>Sampling Depth</label>
                <input type="number" id="shots" name="shots" value="1024">
            </div>
            <button type="submit" class="btn-execute">Initialize Link</button>
        </form>

        <div class="stat-card" style="margin-top: 20px;">
            <label>System Logs</label>
            <div id="log">> Awaiting Command...</div>
        </div>
    </div>

    <div class="data-display">
        <div class="panel" id="results-panel" style="opacity: 0;">
            <h1>DATA ANALYSIS</h1>
            <div class="stat-card">
                <label>Circuit Schematic</label>
                <img id="circuitImg" src="" alt="Circuit">
            </div>
            <div class="stat-card">
                <label>Measurement Probability</label>
                <img id="histImg" src="" alt="Histogram">
            </div>
        </div>
    </div>
</div>

<script>
const container = document.getElementById('canvas-container');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);
container.appendChild(renderer.domElement);

const geometry = new THREE.SphereGeometry(1.5, 32, 32); // smaller globe
const material = new THREE.MeshPhongMaterial({ color:0xbc13fe, wireframe:true, transparent:true, opacity:0.3 });
const globe = new THREE.Mesh(geometry, material);
scene.add(globe);

const coreGeom = new THREE.SphereGeometry(0.35,32,32); // smaller core
const coreMat = new THREE.MeshBasicMaterial({color:0x00f3ff});
const core = new THREE.Mesh(coreGeom, coreMat);
scene.add(core);

const light = new THREE.PointLight(0x00f3ff,2,100);
light.position.set(10,10,10);
scene.add(light);
scene.add(new THREE.AmbientLight(0x404040));

camera.position.z = 5; // closer for smaller globe

function animate(){
    requestAnimationFrame(animate);
    globe.rotation.y += 0.005;
    globe.rotation.x += 0.002;
    core.scale.x = 1 + Math.sin(Date.now()*0.005)*0.2;
    core.scale.y = 1 + Math.sin(Date.now()*0.005)*0.2;
    renderer.render(scene,camera);
}
animate();

document.getElementById('simForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const log = document.getElementById('log');
    log.innerHTML = "> Accessing Q-Stream...<br>> Rotating Bloch Vector...";
    globe.material.color.setHex(0xbfff00);

    const formData = new FormData(e.target);
    try{
        const response = await fetch('/simulate',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
                state: formData.get('state'),
                shots: formData.get('shots')
            })
        });
        const result = await response.json();

        document.getElementById('circuitImg').src = result.circuit_img;
        document.getElementById('histImg').src = result.hist_img;
        document.getElementById('circuitImg').style.display = 'block';
        document.getElementById('histImg').style.display = 'block';
        document.getElementById('results-panel').style.opacity = '1';
        
        log.innerHTML += `<br>> Success. Correlation: ${result.correlation}`;
        globe.material.color.setHex(0xbc13fe);
    } catch(err){
        log.innerHTML += "<br>> ERROR: Connection Failed.";
    }
});

window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
